# Schmidt-Samoa 密码体系

## 算法流程

选取两个大质数 $p, q$，令 $N = p^2q$ 作为公钥，计算 $d \equiv N^{-1}\pmod{\phi(pq)}$，作为私钥。

选取小于 $pq$ 的密文 $m$，计算 $c \equiv m^N \pmod{N}$ 作为密文。

解密时计算 $c^d \bmod pq$ 得到明文。

## 解密过程

计算明文过程类似 RSA，正确性可以用欧拉定理容易地证明。

$$
c^d \equiv m^{Nd} \equiv m^{k\phi(pq)+1} \equiv m \pmod{pq}
$$

主要问题是如何得到 $pq$。

由上述推导式可以发现有
$$
m^{Nd} \equiv m \pmod{pq}
$$

不妨取 $m=2$，于是有 

$$
2^{Nd} \equiv 2 \pmod{pq}
$$

也就是 

$$
2^{Nd} - 2 = kpq
$$

在已知公钥 $N$ 和私钥 $d$ 的情况下，可以同时取与 $N$ 的最大公约数，得到 $pq$ 的值。即 

$$
\gcd(2^{Nd} - 2, N) = \gcd(kpq, p^2q) = pq
$$

在具体实现中，计算 $2^{Nd} - 2$ 时只需计算模 $N$ 意义下的值即可，不影响最终结果。

可以发现，上述流程同样适用 $p^kq$ 的加密体系 ~~（但是 $k$ 变大似乎没什么必要~~。

## 常见变式

CTF 题目中常见一个变式是将私钥取成在模 $\operatorname{lcm}(p - 1, q - 1)$ 域上的逆元而非 $(p - 1)(q - 1)$，此时上述证明过程不成立，但是仍可按照相同流程解密。

找了一些网上的文章，要么就是贴出证明时将私钥取作模 $(p - 1)(q - 1)$ 域上的逆元，然后做题的时候又对代码里的 $\operatorname{lcm}(p - 1, q - 1)$ 视而不见，要么就是只有如下一句话说明：

> 因为 $\operatorname{lcm}(p−1,q−1)$ 已经是 $(p−1)(q−1)$ 非常大的因子，由拉格朗日定理，$2$ 生成的子群的阶应该是 $(p−1)(q−1)$ 的因数，所以概率还挺高的。

看起来没什么问题，唯一的问题是我看不懂。气急败坏的我找到了 Schmidt-Samoa 加密体系原论文，一通翻阅，发现这个更看不懂……也是，我要是看得懂才奇怪。

看来不得不去补习群论与数论基础知识了，鉴定为数论底子吃光了导致的。